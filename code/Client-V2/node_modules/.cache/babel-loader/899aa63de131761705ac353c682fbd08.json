{"ast":null,"code":"import _regeneratorRuntime from \"E:\\\\DoAnTotNghiep\\\\code\\\\Client-V2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"E:\\\\DoAnTotNghiep\\\\code\\\\Client-V2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"E:\\\\DoAnTotNghiep\\\\code\\\\Client-V2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\DoAnTotNghiep\\\\code\\\\Client-V2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\";\nimport MenuService from \"../services/MenuService\";\nimport history from \"history.js\";\nvar config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization': 'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n};\n\nvar JwtAuthService = /*#__PURE__*/function () {\n  function JwtAuthService() {\n    var _this = this;\n\n    _classCallCheck(this, JwtAuthService);\n\n    this.user = {\n      userId: \"1\",\n      role: 'ADMIN',\n      displayName: \"Watson Joyce\",\n      email: \"watsonjoyce@gmail.com\",\n      photoURL: ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\",\n      age: 25,\n      token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n    };\n\n    this.loginWithEmailAndPassword = function (email, password) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          resolve(_this.user);\n        }, 1000);\n      }).then(function (data) {\n        //console.log(data);\n        _this.setUser(data);\n\n        _this.setSession(data.token);\n\n        return data;\n      });\n    };\n\n    this.loginWithToken = function () {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          resolve(_this.user);\n        }, 100);\n      }).then(function (data) {\n        _this.setSession(data.token);\n\n        _this.setUser(data);\n\n        return data;\n      });\n    };\n\n    this.getLoginUser = function () {\n      return localStorageService.getItem(\"auth_user\");\n    };\n\n    this.setUser = function (user) {\n      localStorageService.setItem('auth_user', user);\n    };\n\n    this.removeUser = function () {\n      localStorageService.removeItem('auth_user');\n    };\n  }\n\n  _createClass(JwtAuthService, [{\n    key: \"getCurrentUser\",\n    value: function () {\n      var _getCurrentUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var url;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = ConstantList.API_ENPOINT + \"/api/users/getCurrentUser\";\n                _context.next = 3;\n                return axios.get(url);\n\n              case 3:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getCurrentUser() {\n        return _getCurrentUser.apply(this, arguments);\n      }\n\n      return getCurrentUser;\n    }()\n  }, {\n    key: \"loginWithUserNameAndPassword\",\n    value: function () {\n      var _loginWithUserNameAndPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(username, password) {\n        var _this2 = this;\n\n        var requestBody, res;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                requestBody = 'client_id=core_client&grant_type=password&client_secret=secret';\n                requestBody = requestBody + '&username=' + username + '&password=' + password;\n                _context2.next = 4;\n                return axios.post(ConstantList.API_ENPOINT + '/oauth/token', requestBody, config).then(function (response) {\n                  console.log(response);\n                  var dateObj = new Date(Date.now() + response.data.expires_in * 1000);\n                  localStorageService.setItem(\"token_expire_time\", dateObj);\n\n                  _this2.setSession(response.data.access_token);\n                });\n\n              case 4:\n                res = _context2.sent;\n                _context2.next = 7;\n                return this.getCurrentUser().then(function (res) {\n                  console.log(res);\n\n                  _this2.setLoginUser(res.data);\n                });\n\n              case 7:\n                _context2.next = 9;\n                return MenuService.getAllMenuItemByRoleList().then(function (res) {\n                  //localStorageService.setSessionItem(\"navigations\",res.data);\n                  localStorageService.setLocalStorageItem(\"navigations\", res.data);\n                });\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loginWithUserNameAndPassword(_x, _x2) {\n        return _loginWithUserNameAndPassword.apply(this, arguments);\n      }\n\n      return loginWithUserNameAndPassword;\n    }()\n  }, {\n    key: \"logout\",\n    value: function () {\n      var _logout = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var url, res;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (ConstantList.AUTH_MODE == \"Keycloak\") {\n                  UserService.doLogout();\n                  this.setSession(null);\n                  this.removeUser();\n                  history.push(ConstantList.HOME_PAGE);\n                } else {\n                  url = ConstantList.API_ENPOINT + \"/oauth/logout\";\n                  res = axios.delete(url);\n                  this.setSession(null);\n                  this.removeUser();\n                  history.push(ConstantList.LOGIN_PAGE);\n                }\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function logout() {\n        return _logout.apply(this, arguments);\n      }\n\n      return logout;\n    }()\n  }, {\n    key: \"setSession\",\n    value: function setSession(token) {\n      if (token) {\n        localStorageService.setItem(\"jwt_token\", token);\n        axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n      } else {\n        localStorageService.removeItem('jwt_token');\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n    }\n  }, {\n    key: \"setLoginUser\",\n    value: function () {\n      var _setLoginUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(user) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                localStorageService.setItem(\"auth_user\", user);\n                return _context4.abrupt(\"return\", user);\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function setLoginUser(_x3) {\n        return _setLoginUser.apply(this, arguments);\n      }\n\n      return setLoginUser;\n    }()\n  }]);\n\n  return JwtAuthService;\n}();\n\nexport default new JwtAuthService();","map":{"version":3,"sources":["E:/DoAnTotNghiep/code/Client-V2/src/app/services/jwtAuthService.js"],"names":["axios","localStorageService","ConstantList","UserService","MenuService","history","config","headers","JwtAuthService","user","userId","role","displayName","email","photoURL","ROOT_PATH","age","token","loginWithEmailAndPassword","password","Promise","resolve","reject","setTimeout","then","data","setUser","setSession","loginWithToken","getLoginUser","getItem","setItem","removeUser","removeItem","url","API_ENPOINT","get","username","requestBody","post","response","console","log","dateObj","Date","now","expires_in","access_token","res","getCurrentUser","setLoginUser","getAllMenuItemByRoleList","setLocalStorageItem","AUTH_MODE","doLogout","push","HOME_PAGE","delete","LOGIN_PAGE","defaults","common"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\";\nimport MenuService from \"../services/MenuService\";\nimport history from \"history.js\";\nconst config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization':'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n}\nclass JwtAuthService {\n\n\n  user = {\n    userId: \"1\",\n    role: 'ADMIN',\n    displayName: \"Watson Joyce\",\n    email: \"watsonjoyce@gmail.com\",\n    photoURL:  ConstantList.ROOT_PATH+\"assets/images/avatar.jpg\",\n    age: 25,\n    token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n  }\n  async getCurrentUser (){\n    let url = ConstantList.API_ENPOINT + \"/api/users/getCurrentUser\";\n    return await axios.get(url);\n  };\n  async loginWithUserNameAndPassword (username, password) {\n    let requestBody ='client_id=core_client&grant_type=password&client_secret=secret';\n    requestBody =requestBody+'&username='+username +'&password='+password;\n    const res = await axios.post(ConstantList.API_ENPOINT+'/oauth/token',requestBody,config).then(response=>{\n      console.log(response);\n      var dateObj = new Date(Date.now() + response.data.expires_in*1000);\n      localStorageService.setItem(\"token_expire_time\",dateObj);\n      this.setSession(response.data.access_token);\n    });\n    //alert('Here')\n    await this.getCurrentUser().then(res=>{\n      console.log(res);\n      this.setLoginUser(res.data);\n    });\n\n    await MenuService.getAllMenuItemByRoleList().then(res=>{\n      //localStorageService.setSessionItem(\"navigations\",res.data);\n      localStorageService.setLocalStorageItem(\"navigations\",res.data);\n    });\n  };\n\n  loginWithEmailAndPassword = (email, password) => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 1000);\n    }).then(data => {\n            //console.log(data);\n      this.setUser(data);\n      this.setSession(data.token);      \n      return data;\n    });\n  };\n\n  loginWithToken = () => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 100);\n    }).then(data => {\n      this.setSession(data.token);\n      this.setUser(data);\n      return data;\n    });\n  };\n\n  \n\n  async logout() {\n    if(ConstantList.AUTH_MODE==\"Keycloak\"){\n      UserService.doLogout();\n      this.setSession(null);\n      this.removeUser();\n      history.push(ConstantList.HOME_PAGE)\n    }else {\n      let url = ConstantList.API_ENPOINT + \"/oauth/logout\";\n      let res = axios.delete(url);\n      this.setSession(null);\n      this.removeUser();\n      history.push(ConstantList.LOGIN_PAGE)\n    }\n  }\n\n  setSession(token){\n    if (token) {\n      localStorageService.setItem(\"jwt_token\", token);\n      axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n    } else {\n      localStorageService.removeItem('jwt_token');\n      delete axios.defaults.headers.common[\"Authorization\"];\n    }\n  };\n  async setLoginUser (user) {\n    localStorageService.setItem(\"auth_user\", user);\n    return user;\n  }\n  getLoginUser = () => {\n    return localStorageService.getItem(\"auth_user\");\n  }\n  // setLoginToken = (data) => {   \n  //   let user ={};\n  //   user.token = data; \n  //   user.role=\"ADMIN\";\n  //   user.age=25;\n  //   user.displayName =\"\"; // cần lấy tên user\n  //   user.photoURL =ConstantList.ROOT_PATH+\"assets/images/avatar.jpg\";\n  //   this.user = user;\n  //   localStorageService.setItem('auth_user', user);\n  //   return user;\n  // }\n\n  setUser = (user) => {    \n    localStorageService.setItem('auth_user', user);\n\n  }\n  removeUser = () => {\n    localStorageService.removeItem('auth_user');\n  }\n}\n\nexport default new JwtAuthService();\n"]},"metadata":{},"sourceType":"module"}